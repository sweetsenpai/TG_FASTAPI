# TG_fastAPI

–¢–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ—Å—Ç–æ–≤ —Å –∞–¥–º–∏–Ω–∫–æ–π –Ω–∞ FastAPI

---

# –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏‚öôÔ∏è
* python 3.11
* FastAPI
* Tortoise ORM + Aerich (–º–∏–≥—Ä–∞—Ü–∏–∏)
* PostgreSQL
* Docker + Docker Compose
* PythonTelegramBot
* JWT (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
---
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫üöÄ
1) –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ª—é–±—ã–º —É–¥–æ–±–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º
2) –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å docker –∏ docker-compose
3) –°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–æ–º–∞–Ω–¥–æ–π:
    ```commandline
    docker-compose up --build
    ```
4) –î–æ–∂–¥–∞—Ç—å—Å—è –º–∏–≥—Ä–∞—Ü–∏–π (–æ–Ω–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ aerich)
5) FastAPI –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É http://localhost:8000
6) –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ API
    –¥–æ—Å—Ç—É–ø–µ–Ω —Ç—É—Ç: https://t.me/TgFastApiTestBot
---
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞üå≥

## API
–ü—Ä–æ–µ–∫—Ç –∞–¥–º–Ω–∏–∫–∏ –Ω–∞ FastAPI

- [app](app)
- - [auth](app/auth) - —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- - [posts](app/posts) - —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ—Å—Ç–æ–≤ –∏ –∏—Ö –ª–æ–≥–∏–∫–∞
- - [schemas](app/schemas) - pydentic schemas –¥–ª—è –ø–æ—Å—Ç–æ–≤ –∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- - [security](app/security) - –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å JWT
- - [main](app/main.py) - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞
- - [logger_config](app/logger_config.py) - –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –ª–æ–≥–µ—Ä–∞
---

## Bot
–ü—Ä–æ–µ–∫—Ç —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞

- [bot](bot)
- - [api_client](bot/api_client.py) - —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å API
- - [keyboards](bot/keyboards.py) - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
- - [posts](bot/posts.py) - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ callback —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ø–æ—Å—Ç–∞–º–∏
- - [utils](bot/utils.py) - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
- - [main](bot/main.py) - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞
- - [logger_config](bot/logger_config.py) - –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –ª–æ–≥–µ—Ä–∞

---
## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
–†–∞–±–æ—Ç–∞ —Å PostgreSQL, –º–∏–≥—Ä–∞—Ü–∏–∏

- [db](db) - –ú–æ–¥–µ–ª–∏ –ë–î
- [configs](configs) - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Tortoise ORM + Aerich –∫ PostgreSQL
- [migrations](migrations) - –º–∏–≥–∞—Ä—Ü–∏–∏
---

## –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ `images`, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `Aerich`, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `python`
- [docker-compose](docker-compose.yml)
- [Dockerfile](Dockerfile)
- [poetry.lock](poetry.lock)
- [pyproject.toml](pyproject.toml)
- [requirements.txt](requirements.txt)
- [.env](.env)
-
---
# API
![API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](img/api_docs_main.png)
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç—É—Ç -> http://localhost:8000/docs/
## Auth
### `POST` /auth/register
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ—Å–Ω–æ–≤–µ `email` –∏ `password`
–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è bash:
```commandline
curl -d '{"email":"test@email.com", "text":"strong_password99"}' -H "Content-Type: application/json" -X POST http://localhost:8000/auth/register/
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
![–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è](img/api_register.png)
---
### `POST` /auth/token
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `access_token` –∏ `refresh_token` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è bash:
```commandline
curl -X POST http://localhost:8000/auth/token
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
![–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤](img/api_get_tokens.png)

---
### `POST` /auth/refresh
–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `access_token` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è bash:
```commandline
curl -X POST http://localhost:8000/auth/refresh
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
![–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤](img/api_refresh_token.png)
---

## Posts
### `GET` /api/posts
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ—Å—Ç–æ–≤ —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è bash:
```commandline
curl http://localhost:8000/api/posts
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
![–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ /api/posts](img/api_all_posts.png)

---
### `GET` /api/posts/menu
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞.
–û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º `text` —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –ø–æ–ª–µ –Ω–µ –Ω—É–∂–Ω–æ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è bash:
```commandline
curl http://localhost:8000/api/posts/menu
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
![–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ /api/posts](img/api_posts_menu.png)

---
### `GET` /api/posts/{post_id}
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –ø–æ –µ–≥–æ `id`

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è bash:
```commandline
curl http://localhost:8000/api/posts/1
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
![–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ /api/posts/post_id](img/api_post_get.png)

---
### `POST` /api/posts/
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–≤–æ–µ `title` - –∑–∞–≥–æ–ª–æ–≤–∫–∞, `text` - —Ç–µ–∫—Å—Ç–∞
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–≥–æ –ø–æ—Å—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.


–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è bash:
```commandline
curl -d '{"title":"–ú–æ–π –¥–ª–∏–Ω–Ω—ã–π –ø–æ—Å—Ç", "text":"–î–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç"}' -H "Content-Type: application/json" -X POST http://localhost:8000/api/posts/
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
![–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ /api/posts/post_id](img/api_post_post.png)
---
### `PATCH` /api/posts/{post_id}
–ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ—Å—Ç–∞ –ø–æ –µ–≥–æ `id`.
–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è bash:
```commandline
curl -d '{"text":"–ú—ã –∏–∑–º–µ–Ω–∏–ª–∏ —Ç–µ–∫—Å—Ç"}' -H "Content-Type: application/json" -X PATCH http://localhost:8000/api/posts/1
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
![–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ /api/posts/post_id](img/api_putch.png)

---
### `DELETE` /api/posts/{post_id}
–£–¥–∞–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ—Å—Ç–∞ –ø–æ –µ–≥–æ `id`.
–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è bash:
```commandline
curl -X DELETE http://localhost:8000/api/posts/4
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
![–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ /api/posts/post_id](img/api_post_delete.png)

# Telegram Bot

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω —Ç—É—Ç -> https://t.me/TgFastApiTestBot

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
![–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã](img/bot_start.png)

–î–ª—è –≤—ã–≤–æ–¥–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø–æ—Å—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—É `/posts`
![–ö–æ–º–∞–Ω–¥–∞ /posts](img/bot_posts.png)

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤, –≤—ã–±—Ä–∞–Ω—ã–π –ø–æ—Å—Ç –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω, –±–æ—Ç —Å–æ–æ–±—â–∏—Ç –æ–± —ç—Ç–æ–º –∏ –æ–±–Ω–æ–≤–∏—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
![–£–¥–∞–ª–µ–Ω—ã–π –ø–æ—Å—Ç](img/bot_delete_post.png)

–ï—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç –Ω–µ —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç API, —Ç–æ –æ–Ω —Å–æ–æ–±—â–∏—Ç –æ–± —ç—Ç–æ–º
![API –ø–∏–∑–¥–∞](img/bot_api_dead.png)

–ï—Å–ª–∏ –ø–æ—Å—Ç–æ–≤ –Ω–µ—Ç, –±–æ—Ç —Å–æ–æ–±—â–∏—Ç –æ–± —ç—Ç–æ–º
![–ù–µ—Ç –ø–æ—Å—Ç–æ–≤](img/bot_zero_posts.png)

## –í—ã–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å—Ç–∞ –∏ –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è
–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å—Ç–∞ –∏ –¥–∞—Ç—ã –µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–∂–∞—Ç—å –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–∫–æ

![–ü–æ—Å—Ç](img/bot_single_post.png)

–ï—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç –Ω–µ —Å–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç API, —Ç–æ –æ–Ω —Å–æ–æ–±—â–∏—Ç –æ–± —ç—Ç–æ–º

![–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫](img/bot_bad_api.png)

–ö–Ω–æ–ø–∫–æ–π –Ω–∞–∑–∞–¥ –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.

---
